extends dialog
block append styles
	style.
		#loginbtn { border-bottom: none; border-left: 32px solid #3ca; position: relative; }
		#loginbtn:before {
			content: ' '; border-style: solid; color: white;
			border-color: transparent transparent transparent #3ca;
			border-width: 20px 0 20px 20px;
			display: block; height: 0px;
			position: absolute; left: 0; top: 0;
		}
		#content { display: none; }

block content
	div#loginForm.box.span12
		p.before You aren’t signed in.
		button#loginbtn.primary.box.span6 Sign into Scrollback
		p.break.before Don’t sign in, but change my nick to:
		form#guestfrm.clearfix
			input#guestnick.box.span3
			button.box.span3(type=submit) Change nick
		p.break.after If you don’t sign in, someone else might steal your nick when you’re not around.
		
block append scripts
	script(src="http://code.jquery.com/jquery.min.js")
	script(src="https://login.persona.org/include.js")
	script.
		navigator.id.watch({
			onlogin: function(assertion) {
				notify("Signing you in…");
				window.parent.postMessage({assertion: assertion}, "*");
			},
			onlogout: function() {
				show();
			}
		});
		
		$(document).ready(function() {
			notify("Checking if you’re already signed in…");
			$("#guestnick").val(location.hash.substr(1).replace(/^guest-/,""));
			
			$("#loginbtn").click(function () {
				navigator.id.request();
			});
			
			$("#guestfrm").submit(function(e) {
				var nick = $("#guestnick").val();
				window.parent.postMessage({ guestname: nick }, "*");
				e.preventDefault();
				return false;
			});
		});